### Project API Endpoints
### Base URL - Update this to match your server URL
@baseUrl = http://localhost:3000
@apiUrl = {{baseUrl}}/api

### Variables
### IMPORTANT: Replace these with actual IDs from your database!
### 
### To get IDs:
### 1. First, run: GET {{apiUrl}}/projects (see below)
### 2. Look at the response - each project has an "_id" field
### 3. For category IDs, check your database or create categories first
### 4. For image IDs, check a project's images array
###
### Example: If a project response shows "_id": "clx123abc456def789", use that
@projectId = your-project-id-here
@categoryId = cml45zx5i00002wuc1k1hciui
@imageId = your-image-id-here

### Auth Variables
### These will be set after login/register
### Copy the accessToken from the response and paste it here
@accessToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJjbWw0eXN0NWswMDAwbmN1Y2RmZ2lkcjRmIiwiZW1haWwiOiJ1c2VyQGV4YW1wbGUuY29tIiwicm9sZSI6IlVTRVIiLCJpYXQiOjE3NzAwMjQzNTQsImV4cCI6MTc3MDYyOTE1NH0.McaRvl9of9jkhJGYFwD_CygAxEO9v0__oVSfMPKNEBI

###############################################
### GET - Get All Projects (No Filters)
### 
### Returns: Array of all projects in database
### If empty: [] (means no projects exist yet)
### 
### Use this first to see what data you have!
###############################################
GET {{apiUrl}}/projects
Content-Type: application/json

### Expected Response Format:
### [
###   {
###     "_id": "clx123abc456def789",
###     "title": "Project Title",
###     "categories": ["privateHouses"],
###     "description": "Project description...",
###     "mainImage": "https://example.com/main.jpg",
###     "images": ["https://example.com/img1.jpg"],
###     "plans": ["https://example.com/plan1.jpg"],
###     "videos": ["https://example.com/video1.mp4"],
###     "location": "Location",
###     "client": "Client Name",
###     "isCompleted": true,
###     "constructionArea": 100,
###     "favourite": false,
###     "createdAt": { "$date": "2024-01-01T00:00:00.000Z" },
###     "updatedAt": { "$date": "2024-01-02T00:00:00.000Z" }
###   }
### ]

###

###############################################
### GET - Get All Projects with Filters
### 
### NOTE: Filters work independently - you can combine them
### Empty result [] means no projects match the filter criteria
###############################################

### Filter by Category ID
### IMPORTANT: Use the category's ID (not urlCode like "privateHouses")
### To find category IDs, check your database or the categories table
GET {{apiUrl}}/projects?category={{categoryId}}
Content-Type: application/json

### Example with actual category ID:
### GET {{apiUrl}}/projects?category=clx789xyz123abc456
### 
### Response: Array of projects in that category
### Empty [] if no projects match

###

### Filter by Favourite Status
### Returns: Only projects where favourite=true
GET {{apiUrl}}/projects?favourite=true
Content-Type: application/json

### Response: Array of favourite projects
### Empty [] if no favourite projects exist

###

### Filter by Non-Favourite Projects
GET {{apiUrl}}/projects?favourite=false
Content-Type: application/json

###

### Filter by Completion Status
### Returns: Only completed projects (isCompleted=true)
GET {{apiUrl}}/projects?isCompleted=true
Content-Type: application/json

### Response: Array of completed projects
### Empty [] if no completed projects exist

###

### Filter by Incomplete Projects
GET {{apiUrl}}/projects?isCompleted=false
Content-Type: application/json

###

### Multiple Filters Combined
### Returns: Projects matching ALL specified filters
### Example: Get incomplete favourite projects in a specific category
GET {{apiUrl}}/projects?category={{categoryId}}&favourite=true&isCompleted=false
Content-Type: application/json

### Example with actual values:
### GET {{apiUrl}}/projects?category=clx789xyz&favourite=true&isCompleted=false
### 
### Response: Array of projects matching ALL criteria
### Empty [] if no projects match all filters

###

###############################################
### GET - Get Favourite Projects
###############################################
GET {{apiUrl}}/projects/favourites
Content-Type: application/json

###

###############################################
### GET - Get Single Project by ID
###############################################
GET {{apiUrl}}/projects/single?id={{projectId}}
Content-Type: application/json

###

###############################################
### POST - Create New Project
###############################################
POST {{apiUrl}}/projects
Content-Type: application/json

{
  "title": "New Project Title",
  "description": "Project description here",
  "location": "Project Location",
  "client": "Client Name",
  "constructionArea": 150,
  "isCompleted": false,
  "favourite": false,
  "categoryIds": ["{{categoryId}}"],
  "images": [
    {
      "url": "https://example.com/main.jpg",
      "type": "MAIN",
      "order": 0
    },
    {
      "url": "https://example.com/image1.jpg",
      "type": "IMAGE",
      "order": 1
    }
  ]
}

###

# Create project without images
POST {{apiUrl}}/projects
Content-Type: application/json

{
  "title": "New Project Without Images",
  "description": "Project description",
  "location": "Location",
  "client": "Client",
  "constructionArea": 100,
  "categoryIds": ["{{categoryId}}"],
  "images": []
}

###

###############################################
### PUT - Update Project
###############################################
PUT {{apiUrl}}/projects
Content-Type: application/json

{
  "id": "{{projectId}}",
  "title": "Updated Project Title",
  "description": "Updated project description",
  "location": "Updated Location",
  "client": "Updated Client Name",
  "isCompleted": true,
  "constructionArea": 150,
  "favourite": true,
  "categoryIds": ["category-id-1", "category-id-2"]
}

###

# Update only specific fields
PUT {{apiUrl}}/projects
Content-Type: application/json

{
  "id": "{{projectId}}",
  "title": "New Title Only",
  "favourite": false
}

###

###############################################
### DELETE - Delete Project
###############################################
DELETE {{apiUrl}}/projects
Content-Type: application/json

{
  "id": "{{projectId}}"
}

### Expected Response:
### {
###   "message": "Project deleted successfully"
### }
###
### Note: This will cascade delete all associated images

###

###############################################
### POST - Upload Project Images
###############################################
POST {{apiUrl}}/projects/uploadImgs
Content-Type: application/json
Authorization: Bearer {{accessToken}}


{
  "id": "{{projectId}}",
  "images": [
    {
      "url": "https://example.com/image1.jpg",
      "type": "IMAGE",
      "order": 0
    },
    {
      "url": "https://example.com/image2.jpg",
      "type": "IMAGE",
      "order": 1
    },
    {
      "url": "https://example.com/main.jpg",
      "type": "MAIN",
      "order": 0
    },
    {
      "url": "https://example.com/plan1.jpg",
      "type": "PLAN",
      "order": 0
    },
    {
      "url": "https://example.com/video1.mp4",
      "type": "VIDEO",
      "order": 0
    }
  ]
}

###

# Upload single image
POST {{apiUrl}}/projects/uploadImgs
Content-Type: application/json

{
  "id": "{{projectId}}",
  "images": [
    {
      "url": "https://example.com/new-image.jpg",
      "type": "IMAGE"
    }
  ]
}

###

###############################################
### DELETE - Delete Main Image
###############################################
DELETE {{apiUrl}}/projects/deleteMainImage
Content-Type: application/json

{
  "id": "{{projectId}}"
}

###

###############################################
### DELETE - Delete Project Images
###############################################
DELETE {{apiUrl}}/projects/deleteImages
Content-Type: application/json

{
  "id": "{{projectId}}",
  "imageIds": ["{{imageId}}", "another-image-id"]
}

###

# Delete single image
DELETE {{apiUrl}}/projects/deleteImages
Content-Type: application/json

{
  "id": "{{projectId}}",
  "imageIds": ["{{imageId}}"]
}

###

###############################################
### Authentication Endpoints
###############################################

### POST - Register New User
### Creates a new user account
### Returns: user object, accessToken, and sets refreshToken in httpOnly cookie
POST {{apiUrl}}/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "SecurePassword123!",
  "name": "Test User"
}

### Expected Response:
### {
###   "user": {
###     "id": "user-id",
###     "email": "user@example.com",
###     "name": "Test User",
###     "role": "USER",
###     "createdAt": "2025-02-02T...",
###     "updatedAt": "2025-02-02T..."
###   },
###   "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
### }
### 
### Note: refreshToken is set in httpOnly cookie automatically
### Password Requirements:
### - At least 8 characters
### - Contains uppercase letter
### - Contains lowercase letter
### - Contains number
### - Contains special character

###

### POST - Login User
### Authenticates user and returns tokens
### Returns: user object, accessToken, and sets refreshToken in httpOnly cookie
POST {{apiUrl}}/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "SecurePassword123!"
}

### Expected Response:
### {
###   "user": {
###     "id": "user-id",
###     "email": "user@example.com",
###     "name": "Test User",
###     "role": "USER",
###     ...
###   },
###   "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
### }
### 
### Note: refreshToken is set in httpOnly cookie automatically
### Copy the accessToken and update @accessToken variable above

###

### POST - Refresh Access Token
### Refreshes the access token using refresh token from cookie
### Returns: new accessToken and sets new refreshToken in httpOnly cookie
POST {{apiUrl}}/auth/refresh
Content-Type: application/json

### Expected Response:
### {
###   "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
### }
### 
### Note: Requires refreshToken cookie (set automatically on login/register)
### Updates both accessToken and refreshToken

###

### GET - Get Current User
### Returns the authenticated user's information
### Requires: Bearer token in Authorization header
GET {{apiUrl}}/auth/me
Content-Type: application/json
Authorization: Bearer {{accessToken}}

### Expected Response:
### {
###   "user": {
###     "id": "user-id",
###     "email": "user@example.com",
###     "name": "Test User",
###     "role": "USER",
###     "createdAt": "2025-02-02T...",
###     "updatedAt": "2025-02-02T..."
###   }
### }
### 
### Note: This endpoint requires authentication
### Copy accessToken from login/register response and set @accessToken variable

###

### POST - Logout User
### Logs out user by invalidating refresh token server-side
### Returns: success message and clears refreshToken cookie
POST {{apiUrl}}/auth/logout
Content-Type: application/json

### Expected Response:
### {
###   "message": "Logged out successfully"
### }
### 
### Note: Requires refreshToken cookie (set automatically on login/register)
### Clears refreshToken cookie and invalidates token server-side

###

### Example Error Cases - Authentication

### Register with existing email (409 Conflict)
POST {{apiUrl}}/auth/register
Content-Type: application/json

{
  "email": "existing@example.com",
  "password": "SecurePassword123!",
  "name": "Test User"
}

###

### Register with invalid password (400 Bad Request)
POST {{apiUrl}}/auth/register
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "weak",
  "name": "Test User"
}

###

### Login with invalid credentials (401 Unauthorized)
POST {{apiUrl}}/auth/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "WrongPassword123!"
}

###

### Get current user without token (401 Unauthorized)
GET {{apiUrl}}/auth/me
Content-Type: application/json

###

### Get current user with invalid token (401 Unauthorized)
GET {{apiUrl}}/auth/me
Content-Type: application/json
Authorization: Bearer invalid-token-here

###

### Refresh token without cookie (401 Unauthorized)
POST {{apiUrl}}/auth/refresh
Content-Type: application/json

###

###############################################
### Health Check (for reference)
###############################################
GET {{apiUrl}}/health
Content-Type: application/json

###

###############################################
### Example Error Cases
###############################################

# Missing project ID
GET {{apiUrl}}/projects/single
Content-Type: application/json

###

# Invalid project ID
GET {{apiUrl}}/projects/single?id=invalid-id
Content-Type: application/json

###

# Update without ID
PUT {{apiUrl}}/projects
Content-Type: application/json

{
  "title": "Missing ID"
}

###

# Upload images without ID
POST {{apiUrl}}/projects/uploadImgs
Content-Type: application/json

{
  "images": [
    {
      "url": "https://example.com/image.jpg",
      "type": "IMAGE"
    }
  ]
}

###

# Invalid image type
POST {{apiUrl}}/projects/uploadImgs
Content-Type: application/json

{
  "id": "{{projectId}}",
  "images": [
    {
      "url": "https://example.com/image.jpg",
      "type": "INVALID_TYPE"
    }
  ]
}

###

# Delete images without ID
DELETE {{apiUrl}}/projects/deleteImages
Content-Type: application/json

{
  "imageIds": ["{{imageId}}"]
}

###

# Invalid categoryIds format
PUT {{apiUrl}}/projects
Content-Type: application/json

{
  "id": "{{projectId}}",
  "categoryIds": "not-an-array"
}

###
